<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>CS180 - Project 5 - Diffusion Models</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="13f9ad28-a8e1-807d-b508-d361c3190458" class="page sans"><header><h1 class="page-title">CS180 - Project 5 - Diffusion Models</h1><p class="page-description"></p></header><div class="page-body"><h1 id="1429ad28-a8e1-80f9-b971-d5492d805897" class="">Overview</h1><p id="1429ad28-a8e1-80fd-858a-eda375f8d1a7" class="">In the first portion of this projected, I explored the DeepFloyd IF diffusion model. Specifically, I implemented diffusion sampling loops and then implemented them to create inpainted and optical illusions. </p><p id="1459ad28-a8e1-80cf-a470-f536a8299084" class="">
</p><p id="1439ad28-a8e1-80fa-9e47-c0ebe374ffef" class=""><em>PART A:</em></p><h1 id="1429ad28-a8e1-8062-a577-e79fe170e439" class="">Set Up</h1><p id="1439ad28-a8e1-8075-9d85-fdbd828ef763" class="">As stated earlier we will be using the DeepFloyd IF diffusion model which is a two stage model. During the first stage, the model creates <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>64</mn><mo>×</mo><mn>64</mn></mrow><annotation encoding="application/x-tex">64 \times 64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">64</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">64</span></span></span></span></span><span>﻿</span></span> sized images, while in the second stage the model takes those images as input and generates <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>256</mn><mo>×</mo><mn>256</mn></mrow><annotation encoding="application/x-tex">256 \times 256</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">256</span></span></span></span></span><span>﻿</span></span> sized images. Note that throughout this project I am using the seed 180.</p><p id="1439ad28-a8e1-80bd-95ab-e2cac501e0f7" class="">
</p><h3 id="1439ad28-a8e1-8001-a241-d88336eab3d4" class="">Sampling form the Model</h3><p id="1439ad28-a8e1-80d7-b4d0-c9be3246180d" class="">Below I have sampled from the model using a variety of prompts and the number of inference steps for each prompt.</p><p id="1439ad28-a8e1-8018-90cf-f08e5033fc71" class=""><em>Note that the text prompts are captioned below each image</em></p><p id="1439ad28-a8e1-8069-b74a-f39ae389a642" class=""><code>num_inference_steps = 10</code></p><div id="1439ad28-a8e1-8094-9056-c37fe94585d1" class="column-list"><div id="1439ad28-a8e1-804b-be7a-dfd436bc98ba" style="width:33.333333333333336%" class="column"><figure id="1439ad28-a8e1-808b-b13c-d758073ab54c" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image.png"/></a><figcaption>an oil painting of a snowy mountain village</figcaption></figure></div><div id="1439ad28-a8e1-80e8-8a9b-d464ad1dc942" style="width:33.333333333333336%" class="column"><figure id="1439ad28-a8e1-80d3-8489-e97f95bb15d4" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%201.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%201.png"/></a><figcaption>a man wearing a hat</figcaption></figure></div><div id="1439ad28-a8e1-8015-8f39-dffc7b1ee8b4" style="width:33.33333333333333%" class="column"><figure id="1439ad28-a8e1-80d6-8c92-d1511ecb4658" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%202.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%202.png"/></a><figcaption>a rocket ship</figcaption></figure></div></div><p id="1439ad28-a8e1-80df-97f9-ed21692fc02c" class=""><code>num_inference_steps = 20</code></p><div id="1439ad28-a8e1-807b-a216-fc876fdbe26a" class="column-list"><div id="1439ad28-a8e1-8021-b2d2-c096b1939cc8" style="width:33.333333333333336%" class="column"><figure id="1439ad28-a8e1-8066-93b5-ca5a5f64f6ec" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%203.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%203.png"/></a><figcaption>an oil painting of a snowy mountain village</figcaption></figure></div><div id="1439ad28-a8e1-80c6-8125-f016257b31f4" style="width:33.33333333333333%" class="column"><figure id="1439ad28-a8e1-80af-b76f-fbdd49c18d4b" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%204.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%204.png"/></a><figcaption>a man wearing a hat</figcaption></figure><p id="1439ad28-a8e1-807e-b39d-c8f9f4f416fe" class="">
</p></div><div id="1439ad28-a8e1-8071-834e-d6459e0e41e0" style="width:33.33333333333334%" class="column"><figure id="1439ad28-a8e1-809e-8bd9-c9e74051cd14" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%205.png"><img style="width:205.33087158203125px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%205.png"/></a><figcaption>a rocket ship</figcaption></figure></div></div><p id="1439ad28-a8e1-80f1-9e89-efbdf02150c7" class=""><code>num_inference_steps = 50</code></p><div id="1439ad28-a8e1-8029-9358-d0fff933435a" class="column-list"><div id="1439ad28-a8e1-8009-8c13-fb53d0aec587" style="width:33.333333333333336%" class="column"><figure id="1439ad28-a8e1-805e-93f9-e686e22bb0bd" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%206.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%206.png"/></a><figcaption>an oil painting of a snowy mountain village</figcaption></figure></div><div id="1439ad28-a8e1-80a1-9d79-e291c1b68c92" style="width:33.333333333333336%" class="column"><figure id="1439ad28-a8e1-8012-9629-d44becc5b6e5" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%207.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%207.png"/></a><figcaption>a man wearing a hat</figcaption></figure></div><div id="1439ad28-a8e1-80a1-b8ab-c62cf965fb0b" style="width:33.33333333333333%" class="column"><figure id="1439ad28-a8e1-80f7-af52-d165e2d63a22" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%208.png"><img style="width:255.9926300048828px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%208.png"/></a><figcaption>a rocket ship</figcaption></figure></div></div><h1 id="1439ad28-a8e1-80bc-884b-ee74eeebd9fe" class="">Sampling Loops</h1><figure id="1439ad28-a8e1-800e-9696-f41a8c8d1c7e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%209.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%209.png"/></a></figure><p id="1439ad28-a8e1-80e7-8700-d8c87c89120c" class="">Now in this part of the project I wrote my own sampling loop code, which use the pertained DeepFloyd deniers. The way the model works is illustrated above where we need to translate pure noise into a clean image. Now to train the model to do this we start off with a clean </p><div id="1439ad28-a8e1-808f-950b-f519f83d96c9" class="column-list"><div id="1439ad28-a8e1-80b5-9a0a-cd49dde3b3aa" style="width:50%" class="column"><p id="1439ad28-a8e1-804f-a9dc-da601f20f51a" class="">image (<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>) and iteravietly add noise to the image. Thus the diffusion model learns to reverse this process. To then generating the images using a diffusion model, you start with pure noise at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">x_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> sampled from a normal distribution. And then you predict and remove part of the noise at each iterative time step. Until you reach <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> with the clean image. For the DeepFloyd model <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">T = 1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1000</span></span></span></span></span><span>﻿</span></span></p><p id="1439ad28-a8e1-809c-8728-cb5c5d6f3c4f" class=""><em>Note that throughout a large portion of part A we used the image of the Campanile on the right as our test image</em><br/><br/></p></div><div id="1439ad28-a8e1-80e3-a2e2-c5284c0485b9" style="width:50%" class="column"><figure id="1439ad28-a8e1-8001-be2c-da9063f79e92" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/campanile.jpg"><img style="width:240px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/campanile.jpg"/></a></figure></div></div><p id="1439ad28-a8e1-801f-b666-c425e5244b81" class="">So here the forward process takes a clean image and adds noise to it. To implement this we can do the following</p><figure id="1439ad28-a8e1-80f9-9e7b-f8dc8eadf41a" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>q</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi>N</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">;</mo><msqrt><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover></msqrt><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub><mo stretchy="false">)</mo><mtext mathvariant="bold">I</mtext><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mspace linebreak="newline"></mspace><mtext>which is the same as computing</mtext><mspace linebreak="newline"></mspace><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></msqrt><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow></msqrt><mi>ϵ</mi><mtext>        where </mtext><mi>ϵ</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">q(x_t|x_0) = N(x_t; \sqrt{\bar \alpha} x_0, (1 - \bar{\alpha}_t)\textbf{I})\newline\newline\text{which is the same as computing}\\ x_t = \sqrt {\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}_t}\epsilon \ \ \ \ \ \ \ \text{ where } \epsilon \sim N(0,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1678em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9178em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span><span style="top:-2.8778em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1222em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord text"><span class="mord textbf">I</span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">which is the same as computing</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1972em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8428em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1972em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1589em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8811em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8411em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1589em;"><span></span></span></span></span></span><span class="mord mathnormal">ϵ</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord text"><span class="mord"> where </span></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></div></figure><p id="1439ad28-a8e1-80b9-935c-fc03cbee17bc" class="">This is what the test image looks like at noise level 250, 200, and 750 respectively</p><figure id="1439ad28-a8e1-80f4-956f-d9266fc54314" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2010.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2010.png"/></a></figure><h1 id="1439ad28-a8e1-8049-9520-e1de585b13c0" class=""><strong>Classical Denoising</strong></h1><p id="1439ad28-a8e1-80bb-8ad0-d3dd36042464" class="">No we will try to denoise these images trying to use a more classical. This time using Gaussian blur filtering and see that the results aren’t that great</p><p id="1439ad28-a8e1-802e-ada0-f99e6a3968e5" class="">My best result was with a kernel size of 7. This was a relatively good balance of getting rid some noise while not blurring too much of the original structure of the images.</p><figure id="1469ad28-a8e1-8068-bb41-c93b1433e7bd" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2010.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2010.png"/></a><figcaption>Noisy Images</figcaption></figure><figure id="1439ad28-a8e1-8037-91ee-e721b11f6131" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2011.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2011.png"/></a><figcaption>Denoised w a Gaussian w kernel size 7</figcaption></figure><h1 id="1439ad28-a8e1-8023-b44c-da391549a261" class="">One Step Denoising</h1><p id="1439ad28-a8e1-8061-b0d0-f97f1aea4d8d" class="">Now, we&#x27;ll implement a pretrained diffusion model to denoise our images. Here we are using a UNet that has already been trained on a <em>very, very</em> large dataset of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_0, x_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span> pairs of images. We can use it to recover Gaussian noise from the image. Then, we can remove this noise to recover (something close to) the original image. </p><p id="1439ad28-a8e1-8090-a609-f94f63503464" class="">The prompt used here is<em> “a high quality photo”</em></p><figure id="1439ad28-a8e1-80c1-bbe5-c6dc9620a3b0" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2012.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2012.png"/></a></figure><figure id="1439ad28-a8e1-80e9-9d3d-f66676a6ff0e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2013.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2013.png"/></a></figure><figure id="1439ad28-a8e1-8054-8f09-dc5fe96ea0a6" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2014.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2014.png"/></a></figure><h1 id="1439ad28-a8e1-8051-b084-e8ba33865047" class=""><strong> Implementing Iterative Denoising</strong></h1><p id="1439ad28-a8e1-8054-916b-fcdc82ba23bc" class="">Rather than doing a one time denoising, diffusion models denoise iteratively</p><p id="1439ad28-a8e1-80c3-90a8-de965b8e3ada" class="">Theoretically, we could start with noise <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1000</mn></msub></mrow><annotation encoding="application/x-tex">x_{1000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> at timestep <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">T=1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1000</span></span></span></span></span><span>﻿</span></span>, denoise for one step to get an estimate of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>999</mn></msub></mrow><annotation encoding="application/x-tex">x_{999}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">999</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>, and continue this all the way until <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>. However, this is computationally inefficient and not cost effective.</p><p id="1439ad28-a8e1-8006-8e53-ea80b3cb243f" class="">By skipping steps we can speed this up. The rationale for why this is possible is due to a connection with differential equations, as described <a href="https://yang-song.net/blog/2021/score/">here</a>. To do this we create a list of timesteps. And go through those time steps. To do this we implement the following</p><figure id="1439ad28-a8e1-806b-9099-c2d3fd946425" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub><mo>=</mo><mfrac><mrow><msqrt><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></msqrt><msub><mi>β</mi><mi>t</mi></msub></mrow><mrow><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow></mfrac><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mfrac><mrow><msqrt><msub><mi>α</mi><mi>t</mi></msub></msqrt><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub><mo stretchy="false">)</mo></mrow><mrow><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow></mfrac><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>v</mi><mi>σ</mi></msub></mrow><annotation encoding="application/x-tex">x_{t&#x27;} = \frac{\sqrt{\bar\alpha_{t&#x27;}}\beta_t}{1 - \bar\alpha_t} x_0 + \frac{\sqrt{\alpha_t}(1 - \bar\alpha_{t&#x27;})}{1 - \bar\alpha_t} x_t + v_\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3069em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4709em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7939em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7539em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2461em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2907em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4547em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7047em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7253em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6853em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div></figure><p id="1439ad28-a8e1-8001-9aff-f8371c8cd2d4" class="">where:</p><ul id="1439ad28-a8e1-80b9-9b08-cfdc08f2843c" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> is the image at time <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span><span>﻿</span></span></li></ul><ul id="1439ad28-a8e1-8034-b0c1-dd30783c8e4e" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></mrow><annotation encoding="application/x-tex">x_{t&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> is your noisy image at timestep <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">t&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> where <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">t&#x27; &lt; t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.791em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span><span>﻿</span></span> (less noisy)</li></ul><ul id="1439ad28-a8e1-80e1-95d1-c8baa0a54b7d" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\bar\alpha_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7178em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> are the <code>alphas_cumprod</code>, which contains all the <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub><mo separator="true">,</mo><mtext>  </mtext><mi>t</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>999</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\bar\alpha_t, \ \ t \in [0, 999]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">999</span><span class="mclose">]</span></span></span></span></span><span>﻿</span></span></li></ul><ul id="1439ad28-a8e1-80a9-84e0-d39f18f1d3db" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><msub><mi>α</mi><mi>t</mi></msub><mo>=</mo><mfrac><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle \alpha_t = \frac{\bar\alpha_t }{\bar\alpha_{t&#x27;}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0808em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2448em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>﻿</span></span></li></ul><ul id="1439ad28-a8e1-8029-84cb-d5bf71c70b97" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>α</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\beta_t = 1 - \alpha_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></li></ul><ul id="1439ad28-a8e1-800e-b9d9-cac9a5305b4a" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> is the current estimate of the clean image</li></ul><div id="1439ad28-a8e1-8085-a847-c7b3f589c8f8" class="column-list"><div id="1439ad28-a8e1-801c-9f00-d1b80cb41754" style="width:50%" class="column"><p id="1439ad28-a8e1-80ed-a393-d04ee2caf83a" class="">The <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>σ</mi></msub></mrow><annotation encoding="application/x-tex">v_\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> is random noise, which in the case of DeepFloyd is also predicted. We can interpret this process as a type of linear interpolation between the signal and nose.</p></div><div id="1439ad28-a8e1-80ee-bced-ce1bf1a5cf13" style="width:50%" class="column"><figure id="1439ad28-a8e1-800e-a504-c12d5307e2ef" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2015.png"><img style="width:321.9852600097656px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2015.png"/></a></figure></div></div><p id="1469ad28-a8e1-809f-b337-e312efce21f1" class="">By using <code>i_start = 10</code>, which means that the denoting process starts at this time step of 10 we get the following and we can see the denoising occurring overtime</p><div id="1439ad28-a8e1-80ca-8a21-f4cf2888c290" class="column-list"><div id="1439ad28-a8e1-802e-8507-ecda156ce04a" style="width:20.000000000000007%" class="column"><figure id="1439ad28-a8e1-805a-baad-ec72a81dfbf5" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2016.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2016.png"/></a><figcaption>t=660</figcaption></figure></div><div id="1439ad28-a8e1-801a-81ab-de48b0d00ef6" style="width:20%" class="column"><figure id="1439ad28-a8e1-801d-862a-f0f5aec8591a" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2017.png"><img style="width:321.9852600097656px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2017.png"/></a><figcaption>t=510</figcaption></figure></div><div id="1439ad28-a8e1-802b-bc94-f8d14381278a" style="width:20%" class="column"><figure id="1439ad28-a8e1-8065-84d0-fcff6ed9b3a6" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2018.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2018.png"/></a><figcaption>t=360</figcaption></figure></div><div id="1439ad28-a8e1-8049-8a08-c5f1604194aa" style="width:20%" class="column"><figure id="1439ad28-a8e1-80d9-bd43-cc53220603dc" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2019.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2019.png"/></a><figcaption>t=210</figcaption></figure></div><div id="1439ad28-a8e1-80b3-8103-f0f74f7ce077" style="width:20%" class="column"><figure id="1439ad28-a8e1-80e7-ae64-c44996fda2eb" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2020.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2020.png"/></a><figcaption>t=60</figcaption></figure></div></div><figure id="1439ad28-a8e1-80c6-9a66-e845d3edc187" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2021.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2021.png"/></a></figure><p id="1469ad28-a8e1-801c-b48a-c0bd3709fc75" class="">As we can see above the image under the title “Iterative Denoising” is the final image after using iterative denoising, while the image under the title “One-Step Denoising” shows the final image after using a single denoising step and it looks much worse. Lastly on the right, the predicted clean image using gaussian blurring is displayed.</p><h1 id="1439ad28-a8e1-80ad-8fda-dc810cc4221d" class="">Diffusion Model Sampling</h1><p id="1439ad28-a8e1-807b-84b8-f256ef14e2b1" class="">Previously, we used the diffusion model to denoise an image. But now we will use it to generate images from scratch by passing in random noise, essentially denoising pure noise. The prompt used here way “<em>a high quality photo</em>”</p><figure id="1439ad28-a8e1-8016-977e-e672457456ba" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2022.png"><img style="width:689.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2022.png"/></a></figure><h1 id="1439ad28-a8e1-80a4-8245-cb93a3bacab3" class=""><strong>Classifier Free Guidance</strong></h1><p id="1439ad28-a8e1-80e1-9511-d3299252d702" class="">In order to improve the image quality, we can use a technique called classifier-free guidance. <em>Note that this comes at the expense of image diversity</em>. In this approach we estimate the noise conditioned on the text prompt and the unconditional noise. The new noise estimate becomes <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>=</mo><msub><mi>ϵ</mi><mi>u</mi></msub><mo>+</mo><mi>γ</mi><mo stretchy="false">(</mo><msub><mi>ϵ</mi><mi>c</mi></msub><mo>−</mo><msub><mi>ϵ</mi><mi>u</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\epsilon = \epsilon_u + \gamma (\epsilon_c - \epsilon_u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span>, with <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span></span><span>﻿</span></span> being the strength of CFG. Here we chose <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\gamma = 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span></span><span>﻿</span></span></p><figure id="1459ad28-a8e1-80ea-9b73-f24b99ccc23e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2023.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2023.png"/></a></figure><h1 id="1459ad28-a8e1-805f-8ad3-c22f50bda4cf" class="">Image-to-Image Translation</h1><p id="1459ad28-a8e1-8092-b1fa-cb9eb2a09551" class="">In this section, we will create an image that is similar to our test image. Essentially, we will add a little it of noise and then force it back onto the image manifold unconditionally. The results below are shown at the noise levels [1, 3, 5, 7, 10, 20] with the text prompt “<em>a high quality photo</em>”.</p><figure id="1459ad28-a8e1-805a-85a2-d78a1d0995a5" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2024.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2024.png"/></a></figure><p id="1459ad28-a8e1-80c4-96be-f04e4f4a5da6" class="">
</p><p id="1459ad28-a8e1-80b2-ad38-f61181d2da90" class="">Then I input the following new images:</p><div id="1459ad28-a8e1-8044-928c-d1d397a2c55d" class="column-list"><div id="1459ad28-a8e1-801b-9442-ff0d9304ed4d" style="width:50%" class="column"><figure id="1459ad28-a8e1-8069-8d82-c120c2ce722f" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_6504.jpg"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_6504.jpg"/></a></figure></div><div id="1459ad28-a8e1-802e-92b6-df56e82f7ac5" style="width:50%" class="column"><figure id="1459ad28-a8e1-80d3-a93c-e483831a3f6d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_0140.jpg"><img style="width:4284px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_0140.jpg"/></a></figure></div></div><p id="1459ad28-a8e1-8096-ad7a-c99195c1d643" class="">And after applying the image-to-image translation it resulted in</p><figure id="1459ad28-a8e1-803d-8a54-e489e8e90340" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2025.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2025.png"/></a></figure><figure id="1459ad28-a8e1-8081-b09e-dee216659eb4" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2026.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2026.png"/></a></figure><h3 id="1459ad28-a8e1-8083-9ead-fdb5ac31f1e9" class="">Editing Hand-Drawn and Web Images</h3><p id="1459ad28-a8e1-8071-a5d9-eb33d04d01ac" class="">Now here I input three more images to the model, one from the internet (middle) and two that I hand drew (left, right)</p><div id="1459ad28-a8e1-8074-937e-c25e927296b5" class="column-list"><div id="1459ad28-a8e1-8064-b267-dc00a3315583" style="width:33.33333333333333%" class="column"><figure id="1459ad28-a8e1-8029-a675-d01a8be7f0a1" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/myImage_(2).png"><img style="width:599.9999389648438px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/myImage_(2).png"/></a></figure></div><div id="1459ad28-a8e1-800d-a9ef-cb5c06ad9877" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-8047-aa70-ce171728ec4f" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2027.png"><img style="width:219.99998474121094px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2027.png"/></a></figure></div><div id="1459ad28-a8e1-8019-ba30-e505cd9ba773" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-803d-85a9-e2a1c0c1f0bf" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/myImage_(1).png"><img style="width:205.33087158203125px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/myImage_(1).png"/></a></figure><p id="1459ad28-a8e1-8022-bc11-d14a9701edc0" class="">
</p></div></div><p id="1459ad28-a8e1-8074-bd21-f0585994bb0e" class="">Which resulted in the following:</p><figure id="1459ad28-a8e1-80d1-aef7-eeceace3c847" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2028.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2028.png"/></a><figcaption>Corresponds to hand drawn frown on the left</figcaption></figure><figure id="1459ad28-a8e1-8079-a980-fda99f22c8fa" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2029.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2029.png"/></a><figcaption>Corresponds to Kirby image in the middle</figcaption></figure><figure id="1459ad28-a8e1-80e5-a143-d33361e88622" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2030.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2030.png"/></a><figcaption>Corresponds to hand drawn stars and triangles on the right</figcaption></figure><p id="1459ad28-a8e1-80f6-bfec-cea16f6e2232" class="">Note that the noise levels of [1, 3, 5, 7, 10, 20] and text prompt remained the same.</p><h3 id="1459ad28-a8e1-8051-8d65-e8bb9a859f53" class="">Inpainting</h3><p id="1459ad28-a8e1-80f9-89b7-f26d255acf1e" class="">Using the methods described in the RePaint paper from Lugmayr et. al, we can create a mask so that we can run the diffusion on a select part of the image. </p><figure id="1459ad28-a8e1-8035-a48f-c814c4374408" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>←</mo><mtext mathvariant="bold">m</mtext><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext mathvariant="bold">m</mtext><mo stretchy="false">)</mo><mtext>forward</mtext><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi></mrow></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_t \leftarrow \textbf{m} x_t + (1 - \textbf{m}) \text{forward}(x_{orig}, t) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord text"><span class="mord textbf">m</span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord textbf">m</span></span><span class="mclose">)</span><span class="mord text"><span class="mord">forward</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span></div></figure><p id="1459ad28-a8e1-8035-aef3-e287c8afc258" class="">Everything inside the mask is untouched while everything outside undergoes the transformation.</p><p id="1459ad28-a8e1-806e-a373-fce7d8109ea8" class="">Here is the resulting</p><div id="1459ad28-a8e1-803a-8386-d51ea52723c7" class="column-list"><div id="1459ad28-a8e1-8004-9131-d9d3081ad676" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-808f-917c-efd4a8663b96" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2031.png"><img style="width:63.98896789550781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2031.png"/></a><figcaption>image</figcaption></figure><p id="1459ad28-a8e1-80cd-bc09-d3ce8a251c4d" class="">
</p></div><div id="1459ad28-a8e1-8025-9d3b-dd8bd632565a" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-805d-b868-ecf811419989" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2032.png"><img style="width:63.98896789550781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2032.png"/></a><figcaption>mask</figcaption></figure></div><div id="1459ad28-a8e1-808b-ab2c-f6d2fc333fd5" style="width:33.33333333333333%" class="column"><figure id="1459ad28-a8e1-80f5-adaf-f98155d2d4c1" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2033.png"><img style="width:63.98896789550781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2033.png"/></a><figcaption>to replace</figcaption></figure></div></div><p id="1459ad28-a8e1-801c-a365-cb3caf78e526" class="">Below are times 990, 840, 690, 540, 390, 240, and 60</p><div id="1459ad28-a8e1-80c7-8dcc-e0ddc931a85f" class="column-list"><div id="1459ad28-a8e1-800c-89a6-e145fbc0b84d" style="width:14.285714285714288%" class="column"><figure id="1459ad28-a8e1-8006-bbbc-e56e814a1dbf" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/990.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/990.png"/></a></figure></div><div id="1459ad28-a8e1-804d-8d7e-c6899c08fd07" style="width:14.285714285714288%" class="column"><figure id="1459ad28-a8e1-8015-83b9-dfbaf2ff9eb4" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/840.png"><img style="width:330.99261474609375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/840.png"/></a></figure></div><div id="1459ad28-a8e1-80be-b25a-d4d43ed57fdc" style="width:14.285714285714288%" class="column"><figure id="1459ad28-a8e1-80b5-9dac-c9f95ca141f2" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/690.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/690.png"/></a></figure></div><div id="1459ad28-a8e1-8093-9fca-cbd9c1e5a572" style="width:14.285714285714288%" class="column"><figure id="1459ad28-a8e1-8060-9f21-f597ff04eafa" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/540.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/540.png"/></a></figure></div><div id="1459ad28-a8e1-80dd-9146-dd6f14ca8f2b" style="width:14.285714285714288%" class="column"><figure id="1459ad28-a8e1-805f-89bc-eb7ff4927eab" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/390.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/390.png"/></a></figure></div><div id="1459ad28-a8e1-805a-9522-f0390da27dd4" style="width:14.285714285714285%" class="column"><figure id="1459ad28-a8e1-8075-892e-ebb00bf9b6b8" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/240.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/240.png"/></a></figure></div><div id="1459ad28-a8e1-8026-b288-c65093bfd79b" style="width:14.285714285714285%" class="column"><figure id="1459ad28-a8e1-8081-af9f-d7a5b0bb1671" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/90.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/90.png"/></a></figure></div></div><p id="1459ad28-a8e1-8097-a6ff-dbf3f09cf42f" class="">Here is the final resulting image</p><figure id="1459ad28-a8e1-804f-9a46-d8ce24fb9b3d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/final.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/final.png"/></a></figure><p id="1459ad28-a8e1-8065-a6b6-f352b70c753f" class="">Here are some examples with my own images</p><div id="1459ad28-a8e1-809c-8eab-f154655eaf0b" class="column-list"><div id="1459ad28-a8e1-801c-ba27-d0a5ed064a45" style="width:50%" class="column"><figure id="1459ad28-a8e1-8022-b177-ce4375daef5c" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_6504%201.jpg"><img style="width:1536px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_6504%201.jpg"/></a></figure><p id="1459ad28-a8e1-806b-bfa6-dcc8864b4ef3" class="">
</p></div><div id="1459ad28-a8e1-8084-a54a-e615a7098899" style="width:50%" class="column"><figure id="1459ad28-a8e1-8063-a1b2-d4a9bff011cb" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_0140%201.jpg"><img style="width:4284px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/IMG_0140%201.jpg"/></a></figure><p id="1459ad28-a8e1-804a-afc2-e325f4760696" class="">
</p></div></div><div id="1459ad28-a8e1-8055-b01f-f5c0307db607" class="column-list"><div id="1459ad28-a8e1-8051-97a7-f7851f643dca" style="width:50%" class="column"><figure id="1459ad28-a8e1-802f-9a4c-e20099f3371a" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2034.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2034.png"/></a></figure></div><div id="1459ad28-a8e1-800a-8999-d8eb833c0360" style="width:50%" class="column"><figure id="1459ad28-a8e1-80ca-8bb7-f5cfaafa15eb" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2035.png"><img style="width:384px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2035.png"/></a></figure></div></div><div id="1459ad28-a8e1-8082-9fd0-f97e39c68629" class="column-list"><div id="1459ad28-a8e1-80f6-a72a-e5465704e601" style="width:50%" class="column"><figure id="1459ad28-a8e1-8034-aa8f-d78187e9936a" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2036.png"><img style="width:425.99261474609375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2036.png"/></a></figure></div><div id="1459ad28-a8e1-8005-8884-cb405edb9bf5" style="width:50%" class="column"><figure id="1459ad28-a8e1-809a-8771-fa3c3303b51f" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2037.png"><img style="width:336px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2037.png"/></a></figure></div></div><p id="1459ad28-a8e1-80ef-a0dd-f2c61c4eefec" class="">With the masks being right over my face and over my cat</p><h3 id="1459ad28-a8e1-804a-9467-e114f54de41d" class="">Text-Conditioned Image-to-image Translation</h3><p id="1459ad28-a8e1-80da-a7f1-ed8756a56020" class="">Here we are changing the prompt from a “high quality photo” to “a rocket ship”. These are the following realists </p><figure id="1459ad28-a8e1-8043-b7b8-e8dba33a2e73" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/rockets.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/rockets.png"/></a></figure><figure id="1459ad28-a8e1-8077-bdde-fa95d83551cf" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2038.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2038.png"/></a></figure><p id="1459ad28-a8e1-80ed-bb7b-f3bb0c17e2c1" class="">And then on my own images:</p><figure id="1459ad28-a8e1-8078-8fb3-e109a898ba23" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2039.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2039.png"/></a></figure><figure id="1459ad28-a8e1-8080-8e95-e985b7ac5658" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2040.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2040.png"/></a></figure><p id="1459ad28-a8e1-80c9-b5a2-f75df0d785f5" class="">The biggest take away is that the bigger the mask I think the better that this works</p><p id="1459ad28-a8e1-80c6-bb4c-e2640821b3cf" class="">So I did my face with a bigger mask and got the following result</p><figure id="1459ad28-a8e1-80c1-9d46-ec29aea2328d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2041.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2041.png"/></a></figure><p id="1459ad28-a8e1-80d8-bbf4-fa03aef97ab7" class="">
</p><h3 id="1459ad28-a8e1-80f2-8376-e56d29bdbd15" class="">Visual Anagrams</h3><p id="1459ad28-a8e1-80cc-b494-dc352b177dee" class="">We can combine everything to create visual anagrams. In this part, we will create an image that looks like &quot;an oil painting of an old man&quot;, but when flipped upside down will reveal &quot;an oil painting of people around a campfire&quot;.</p><p id="1459ad28-a8e1-80c4-b0bc-df0c31430f43" class="">Left is the original, right is the flipped (I’ve outlined the fire in pink to make it more clear)</p><div id="1459ad28-a8e1-806c-baa3-d4fa936aa7c8" class="column-list"><div id="1459ad28-a8e1-802b-8e92-c65b5120d220" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-80ba-b9bb-fb432064dbd7" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/476da535-6514-4609-9b78-bfec48dd9cd0.png"><img style="width:328.44327176781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/476da535-6514-4609-9b78-bfec48dd9cd0.png"/></a><figcaption>“an oil painting of an old man”</figcaption></figure><p id="1469ad28-a8e1-80b6-be89-f8797aab465c" class="">
</p></div><div id="1459ad28-a8e1-807c-8e1f-e680e600c91c" style="width:33.333333333333336%" class="column"><figure id="1459ad28-a8e1-8016-a3a7-d7b66485e26e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/5f82fb23-a351-4e03-9f0a-58c54d79fe54.png"><img style="width:327.57894736842104px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/5f82fb23-a351-4e03-9f0a-58c54d79fe54.png"/></a><figcaption>“an oil painting of people around a campfire” [flipped] </figcaption></figure></div><div id="1469ad28-a8e1-8065-8d1a-ddf36c253668" style="width:33.33333333333333%" class="column"><figure id="1469ad28-a8e1-80ca-8a27-c05240839bc9" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2042.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2042.png"/></a><figcaption>flipped and annotated</figcaption></figure></div></div><p id="1469ad28-a8e1-8080-b89d-d3ff77eb74aa" class="">Here is another attempt at the same visual anagram of prompts with an old man and campfire. On the right the campfire is at the bottom with lots of logs in it (the hair on the image of the man on the left) and smoke (the beard of the man on the left).</p><div id="1469ad28-a8e1-803d-83d1-ecf6de7e513a" class="column-list"><div id="1469ad28-a8e1-8051-bf70-c2afa06e17b9" style="width:50%" class="column"><figure id="1469ad28-a8e1-80f7-93af-eedbb98b8ae3" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/1a1ac947-43f7-4f7b-b022-c541785895e4.png"><img style="width:325.86387434554973px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/1a1ac947-43f7-4f7b-b022-c541785895e4.png"/></a><figcaption>“an oil painting of an old man”</figcaption></figure></div><div id="1469ad28-a8e1-8056-a2af-c353b1bd4bda" style="width:50%" class="column"><figure id="1469ad28-a8e1-80bb-9a79-dbc68579bac1" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/3576b064-2b92-4866-977e-2377805a658a.png"><img style="width:326.7191601049869px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/3576b064-2b92-4866-977e-2377805a658a.png"/></a><figcaption>“an oil painting of people around a campfire” [flipped]</figcaption></figure></div></div><p id="1469ad28-a8e1-80df-b15e-d559080f7991" class="">
</p><div id="1459ad28-a8e1-804a-8d90-c13ac5430422" class="column-list"><div id="1459ad28-a8e1-8072-bff0-e4acbabcdfd4" style="width:50%" class="column"><figure id="1459ad28-a8e1-80f0-964c-fa6e383edc33" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2043.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2043.png"/></a><figcaption>&#x27;a lithograph of waterfalls’</figcaption></figure></div><div id="1459ad28-a8e1-80c4-938a-c82d3dbefb22" style="width:50%" class="column"><figure id="1459ad28-a8e1-806e-afd6-ee679159e769" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2044.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2044.png"/></a><figcaption>&#x27;a lithograph of skulls’ [flipped]</figcaption></figure></div></div><div id="1459ad28-a8e1-80fa-a4ee-c24ea3cff3f5" class="column-list"><div id="1459ad28-a8e1-80f4-b96b-e1d5a7cf6619" style="width:50%" class="column"><figure id="1459ad28-a8e1-803f-b08c-d0f91b65fb9a" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2045.png"><img style="width:388.98895263671875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2045.png"/></a><figcaption>&#x27;a man wearing a hat’</figcaption></figure></div><div id="1459ad28-a8e1-80fe-9487-f1cd114bc48b" style="width:50%" class="column"><figure id="1459ad28-a8e1-8010-b25b-fe17cbe14aea" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2046.png"><img style="width:483.0146789550781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2046.png"/></a><figcaption>&#x27;a rocket ship’</figcaption></figure></div></div><p id="1459ad28-a8e1-80a8-bfb8-f24e6fc96662" class="">I’ve outlined the rocketship with the stream of gas behind it in the flipped version because it’s a little harder to see. The man with the hat has a beard.</p><h1 id="1459ad28-a8e1-8044-91af-da13f39693e7" class="">Hybrid Images</h1><p id="1459ad28-a8e1-80b5-9511-ed1ecd64e890" class="">Here we can create hybrid images using a diffusion model inspired by the techniques we used in our earlier frequency project. To do this we create a hybrid noise first, using the estimations of noise from two different text prompts. From here we combine the two different noise estimations by taking the high frequencies from one and the low frequencies from the other. Mathematically it looks like:</p><figure id="1459ad28-a8e1-8074-977e-c44face75eff" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>ϵ</mi><mn>1</mn></msub><mo>=</mo><mtext>UNet</mtext><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo separator="true">,</mo><msub><mi>p</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><msub><mi>ϵ</mi><mn>2</mn></msub><mo>=</mo><mtext>UNet</mtext><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo separator="true">,</mo><msub><mi>p</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><msub><mi>ϵ</mi><mtext>hybrid</mtext></msub><mo>=</mo><msub><mi>f</mi><mtext>lowpass</mtext></msub><mo stretchy="false">(</mo><msub><mi>ϵ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>f</mi><mtext>highpass</mtext></msub><mo stretchy="false">(</mo><msub><mi>ϵ</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\epsilon_1 = \text{UNet}(x_t, t, p_1)\newline\epsilon_2 = \text{UNet}(x_t, t, p_2)\newline\epsilon_{\text{hybrid}} = f_\text{lowpass}(\epsilon_1) + f_\text{highpass}(\epsilon_2)

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">UNet</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">UNet</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">hybrid</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">lowpass</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">highpass</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div></figure><p id="1459ad28-a8e1-800d-b683-fb05ef6d698f" class="">where <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> are the two text prompt embeddings. This is known as factorized diffusion.</p><p id="1459ad28-a8e1-80c5-bc57-f21982796514" class="">Here are some examples:</p><p id="1469ad28-a8e1-80cf-b1bc-db559ccb6e7e" class="">Hybrid image of “<em>a lithograph of a skull</em>” and “<em>a lithograph of waterfalls</em>”</p><div id="1469ad28-a8e1-801e-9408-f0047466dd7d" class="column-list"><div id="1469ad28-a8e1-809b-ad88-d633a6658c0b" style="width:50%" class="column"><figure id="1459ad28-a8e1-80c2-a8e3-edadae39650d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/download_(9).png"><img style="width:635.9926147460938px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/download_(9).png"/></a></figure></div><div id="1469ad28-a8e1-8058-8d49-e1f734cc2e09" style="width:50%" class="column"><figure id="1469ad28-a8e1-80d2-9720-e0582e61cb9a" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/download_(9).png"><img style="width:108px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/download_(9).png"/></a></figure><p id="1469ad28-a8e1-80c2-bc2f-dc09fb3ee2c7" class="">Further away you can see one big skull off to the right. Potentially with smaller skulls ontop of it</p></div></div><p id="1469ad28-a8e1-808c-a93d-f5af76d4f92c" class="">Here’s another attempt at the skull and waterfall:</p><div id="1469ad28-a8e1-80d5-ba98-da64f6367f24" class="column-list"><div id="1469ad28-a8e1-80f1-89ed-ca5c0c54b866" style="width:50%" class="column"><figure id="1469ad28-a8e1-809b-9949-f8d6af82ed13" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2047.png"><img style="width:635.9926147460938px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2047.png"/></a></figure></div><div id="1469ad28-a8e1-8065-a78e-fd69d34a3848" style="width:50%" class="column"><figure id="1469ad28-a8e1-8019-b2db-ce92ae6aab20" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2048.png"><img style="width:108px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2048.png"/></a></figure><p id="1469ad28-a8e1-80c1-9090-fd22fee37771" class="">
</p></div></div><p id="1469ad28-a8e1-80c5-9529-cfa332200514" class="">On the left you can see a waterfall passing through some trees and turning into a river. While on the right further away, you can make out facial features of a skull</p><p id="1469ad28-a8e1-803e-a574-cd7f9734793d" class="">
</p><p id="1469ad28-a8e1-80f8-ab96-fc22bac72a71" class="">Here are two other examples</p><p id="1469ad28-a8e1-80fd-8ca2-de12a671cd6d" class="">This combines &#x27;an oil painting of a snowy mountain village’ with &#x27;a photo of the amalfi cost’</p><div id="1469ad28-a8e1-80c7-aff0-ee7434787573" class="column-list"><div id="1469ad28-a8e1-8058-b911-d09eb86b04b4" style="width:50%" class="column"><figure id="1469ad28-a8e1-80d1-9842-d1e9406a2c11" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2049.png"><img style="width:635.9926147460938px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2049.png"/></a></figure></div><div id="1469ad28-a8e1-802b-8e7f-d14d93dc53f0" style="width:50%" class="column"><figure id="1469ad28-a8e1-8045-b904-f48f973205b9" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2049.png"><img style="width:96px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2049.png"/></a></figure></div></div><p id="1469ad28-a8e1-807d-bde4-fa65b2290232" class="">Up close it looks like the snowy mountain village with the mountains in the background but from far away you can more clearly see the cost and the shoreline.</p><p id="1469ad28-a8e1-80e1-a9a3-e7a79132abae" class="">
</p><p id="1469ad28-a8e1-8069-be23-e5f033eb54ee" class="">And here are two different examples of combining &#x27;a man wearing a hat’ with ‘a rocket ship’</p><p id="1469ad28-a8e1-80b5-b7b3-e782b15ace02" class="">
</p><div id="1469ad28-a8e1-80e1-b7db-d19e6dde6459" class="column-list"><div id="1469ad28-a8e1-8046-a016-ca31b37f8f9d" style="width:50%" class="column"><figure id="1469ad28-a8e1-80ff-8cbc-d60a3a7919cc" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2050.png"><img style="width:635.9926147460938px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2050.png"/></a></figure></div><div id="1469ad28-a8e1-80a3-a2e3-ecbe604c41af" style="width:50%" class="column"><figure id="1469ad28-a8e1-80d0-b488-ee530e31dc5e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2050.png"><img style="width:96px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2050.png"/></a></figure></div></div><p id="1469ad28-a8e1-805c-9a98-d4e876a87bb1" class="">
</p><p id="1469ad28-a8e1-80d4-9ab4-f9f2ea489eda" class="">In both you can see a man with a hat take the whole frame up but up close it’s a rocket in the sky</p><div id="1469ad28-a8e1-809f-905c-d30eff1a886f" class="column-list"><div id="1469ad28-a8e1-80de-8c6e-c9685eafdb2d" style="width:50%" class="column"><figure id="1469ad28-a8e1-800e-9812-e0a698c8c32f" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2051.png"><img style="width:330.99261474609375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2051.png"/></a></figure></div><div id="1469ad28-a8e1-80fb-a770-ef007c894e8c" style="width:50%" class="column"><figure id="1469ad28-a8e1-8059-8841-de5d46aaa506" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2051.png"><img style="width:84px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2051.png"/></a></figure></div></div><p id="1469ad28-a8e1-8012-be0a-f0d71f2c0eaf" class=""><em><span style="border-bottom:0.05em solid">PART B:</span></em></p><h1 id="1449ad28-a8e1-80da-9e90-cde5eaf0d820" class="">Overview</h1><p id="1449ad28-a8e1-8013-b1f8-c070aa6708d2" class="">In the second part of this project, we are instead building the diffusion models form the ground up using the MNIST dataset. </p><h1 id="1439ad28-a8e1-8079-abaf-cae73baf3acd" class=""><strong>Training a Single-Step Denoising UNet</strong></h1><p id="1449ad28-a8e1-80af-8f3f-c00b4a320d13" class="">For this part of the project we start by building a single-step denoising UNet using the following architecture </p><figure id="1449ad28-a8e1-809b-b888-f5b03ac40369" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2052.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2052.png"/></a></figure><p id="1439ad28-a8e1-8023-98c5-d41096715f3b" class="">Along with the following simple and composed operators </p><figure id="1449ad28-a8e1-8093-a8aa-d7d34a451053" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2053.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2053.png"/></a></figure><h3 id="1449ad28-a8e1-80fc-ad1f-e81505f12f2f" class=""><strong>Using the UNet to Train a Denoiser</strong></h3><p id="1449ad28-a8e1-80d8-a6d1-d839122e5ca4" class="">If we have a noisy image <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span></span><span>﻿</span></span>, and we want to train a denoiser <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">D_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> to map <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span></span><span>﻿</span></span> to a clean image <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span><span>﻿</span></span>. We can use the L2 loss as follows</p><figure id="1449ad28-a8e1-80ec-abcf-e197bfd26e5c" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><mi mathvariant="double-struck">E</mi><mrow><mi>z</mi><mo separator="true">,</mo><mi>x</mi></mrow><msup><mrow><mo fence="true">∥</mo><mi>D</mi><mi>θ</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>−</mo><mi>x</mi><mo fence="true">∥</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L=\mathbb{E}{z, x}\left\|D\theta(z)-x\right\|^2 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.204em;vertical-align:-0.25em;"></span><span class="mord mathbb">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">∥</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">x</span><span class="mclose delimcenter" style="top:0em;">∥</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></div></figure><p id="1449ad28-a8e1-802c-a62a-cac170090976" class="">We need training data pairs of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>z</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(z, x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span> to train the denoiser. So during each training batch, we can generate <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span></span><span>﻿</span></span> from <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span><span>﻿</span></span> as follows:</p><figure id="1449ad28-a8e1-80fb-998f-e4746acc3f9d" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>z</mi><mo>=</mo><mi>x</mi><mo>+</mo><mi>σ</mi><mi>ϵ</mi><mo separator="true">,</mo><mspace width="1em"/><mtext> where </mtext><mi>ϵ</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">z=x+\sigma \epsilon, \quad \text { where } \epsilon \sim N(0, I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mord mathnormal">ϵ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord"> where </span></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">)</span></span></span></span></span></div></figure><p id="1449ad28-a8e1-803c-b916-d2707c1ada50" class="">Here we will show the different noising processes over <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.2</mn><mo separator="true">,</mo><mn>0.4</mn><mo separator="true">,</mo><mn>0.5</mn><mo separator="true">,</mo><mn>0.6</mn><mo separator="true">,</mo><mn>0.8</mn><mo separator="true">,</mo><mn>1.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\sigma=[0.0,0.2,0.4,0.5,0.6,0.8,1.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1.0</span><span class="mclose">]</span></span></span></span></span><span>﻿</span></span></p><figure id="1449ad28-a8e1-804c-9294-cea2a23f24b5" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2054.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2054.png"/></a></figure><h3 id="1449ad28-a8e1-8019-93a0-def9d773ff5a" class="">Training Unconditional Net</h3><p id="1449ad28-a8e1-802d-b9bc-c24eebe5cdb9" class="">Now we can use this data and train the unconditional Unet to denoise. This results in the following after 1 and 5epochs of training with <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\sigma =0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span></span></span></span></span><span>﻿</span></span></p><div id="1469ad28-a8e1-80eb-92e0-e19081c52c6c" class="column-list"><div id="1469ad28-a8e1-80b7-a79f-fcbdbedd87f2" style="width:50%" class="column"><figure id="1469ad28-a8e1-8088-ba5b-c22faabd462e" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2055.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2055.png"/></a><figcaption>Results on digits from the test set after 1 epoch of training</figcaption></figure></div><div id="1469ad28-a8e1-808e-a106-da97d2c5026c" style="width:50%" class="column"><figure id="1469ad28-a8e1-80db-9690-e6bdd69d7ad2" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2056.png"><img style="width:330.99261474609375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2056.png"/></a><figcaption>Results on digits from the test set after 5 epochs of training</figcaption></figure></div></div><p id="1469ad28-a8e1-8052-977d-f4f11c01225e" class="">And this is the training loss curve of the training process.</p><figure id="1469ad28-a8e1-80de-98e8-c472bde388d2" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2057.png"><img style="width:703.9889526367188px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2057.png"/></a></figure><h3 id="1449ad28-a8e1-8069-9763-dfc619b9ba43" class=""><strong>Out-of-Distribution Testing</strong></h3><p id="1449ad28-a8e1-8047-9b04-d199a96ad07a" class="">Now as noted earlier we trained our model with <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\sigma = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span></span></span></span></span><span>﻿</span></span>, let’s see if our model can predict outside the distribution by using other values for <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span></span><span>﻿</span></span></p><figure id="1449ad28-a8e1-8015-9f59-f62b8ced0e23" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2058.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2058.png"/></a></figure><p id="1449ad28-a8e1-808d-93f9-e8451bec1434" class="">As we can see it does predict relatively well for other values of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span></span><span>﻿</span></span>. Note here we used <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.2</mn><mo separator="true">,</mo><mn>0.4</mn><mo separator="true">,</mo><mn>0.5</mn><mo separator="true">,</mo><mn>0.6</mn><mo separator="true">,</mo><mn>0.8</mn><mo separator="true">,</mo><mn>1.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\sigma=[0.0,0.2,0.4,0.5,0.6,0.8,1.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1.0</span><span class="mclose">]</span></span></span></span></span><span>﻿</span></span></p><h1 id="1449ad28-a8e1-801f-8718-c865d0bd4926" class=""><strong>Training a Diffusion Model</strong></h1><h3 id="1449ad28-a8e1-801c-96e1-c66ca02bbe59" class="">Adding Time <strong>Conditioning to UNet</strong></h3><p id="1449ad28-a8e1-8055-af77-e7af13dfb0a6" class="">To inject scalar <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span><span>﻿</span></span> into the UNet model to condition it the 180 course staff suggested using the following archtecture</p><figure id="1449ad28-a8e1-8014-9005-d1582f9cc3e6" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2059.png"><img style="width:2464px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2059.png"/></a></figure><p id="1449ad28-a8e1-80b7-b081-ee874ff1dcfe" class="">Where more specifically those fully connected (FC) blocks are are shown as follows</p><figure id="1449ad28-a8e1-8017-b1aa-f23b89e1c64d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2060.png"><img style="width:707.9962768554688px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2060.png"/></a></figure><h3 id="1449ad28-a8e1-8044-b12a-ec04d01001c1" class=""><strong>Training the UNet</strong></h3><figure id="1459ad28-a8e1-80a9-bc03-cbd4ed565ca3" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2061.png"><img style="width:275.4779357910156px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2061.png"/></a></figure><p id="1449ad28-a8e1-8016-bc6e-d9c3024c96f5" class="">Here to train the UNet we take inspiration from  Ho et al. (2020) in their paper <a href="https://doi.org/10.48550/arXiv.2006.11239">Denoising Diffusion Probabilistic Models</a>. As we follow the pseudocode seen above. We repeat this for different images and values of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span><span>﻿</span></span> until the model converges as shown below</p><figure id="1459ad28-a8e1-8069-a5fe-eed040813d30" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2062.png"><img style="width:483.0146789550781px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2062.png"/></a></figure><h3 id="1449ad28-a8e1-80fe-b49f-fbe1890f3341" class=""><strong>Sampling from the UNet</strong></h3><figure id="1459ad28-a8e1-80d1-83fb-ede5db42affb" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2063.png"><img style="width:597.003662109375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2063.png"/></a></figure><p id="1459ad28-a8e1-8042-be3b-de41b2a3b3cc" class="">In order to sample, we use the algorithm above also described by Ho et al. Here are the resulting samples from epoch 5 and 20</p><figure id="1459ad28-a8e1-801d-a5a3-df02c1393161" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2064.png"><img style="width:597.003662109375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2064.png"/></a><figcaption>Sampling from time conditioned UNet after 5 epochs</figcaption></figure><figure id="1459ad28-a8e1-8037-b0de-cc8b8da21058" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2065.png"><img style="width:597.003662109375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2065.png"/></a><figcaption>Sampling from time conditioned UNet after 20 epochs</figcaption></figure><h3 id="1449ad28-a8e1-80d6-84e5-c38e7430b9db" class=""><strong>Adding Class-Conditioning to UNet</strong></h3><p id="1459ad28-a8e1-803a-906a-fe3d9c39af92" class="">In order to improve our results we can do class conditioning to focus on each digit. By doing so we will add 2 more FCBlocks and adding a one hot encoded vector for the classes rather than a scalar. Also here we will include a 10% dropout</p><h3 id="1449ad28-a8e1-8015-8434-c9bbae258cc0" class=""><strong>Sampling from the Class-Conditioned UNet</strong></h3><figure id="1459ad28-a8e1-8098-8520-f146d329ad6f" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2066.png"><img style="width:597.003662109375px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2066.png"/></a></figure><p id="1459ad28-a8e1-80ee-a341-f4f3a60e558b" class="">To do camping again we reference Ho et. al. for their sampling algorithm. Here are the resulting samples from epoch 5 and 20. However they look very similar thus for a more stark contrast I’ve also included epoch 1.</p><div id="1459ad28-a8e1-805d-985b-fb8af8c0752c" class="column-list"><div id="1459ad28-a8e1-80fd-9fb7-f4c1f2e19b79" style="width:50%" class="column"><figure id="1459ad28-a8e1-80ff-8390-e01f99c13d8d" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2067.png"><img style="width:674.9815673828125px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2067.png"/></a><figcaption>Sampling from class conditioned UNet after 5 epochs</figcaption></figure></div><div id="1459ad28-a8e1-80ba-87e2-cfc2c3cbc864" style="width:50%" class="column"><figure id="1459ad28-a8e1-80fe-85da-e328f7c7cf08" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2068.png"><img style="width:674.9815673828125px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2068.png"/></a><figcaption>Sampling from class conditioned UNet after 5 epochs</figcaption></figure></div></div><figure id="1459ad28-a8e1-802a-afb5-c55952cddb54" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2069.png"><img style="width:674.9815673828125px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2069.png"/></a><figcaption>Sampling from class conditioned UNet after 1 epoch</figcaption></figure><p id="1459ad28-a8e1-8089-91f4-fce50e98e1e5" class="">And lastly here is the training loss overtime</p><figure id="1469ad28-a8e1-8034-bd9c-e6b45e439f14" class="image"><a href="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2070.png"><img style="width:701.9852294921875px" src="CS180%20-%20Project%205%20-%20Diffusion%20Models%2013f9ad28a8e1807db508d361c3190458/image%2070.png"/></a></figure><p id="1469ad28-a8e1-8053-8598-c1e615cd3ce6" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>